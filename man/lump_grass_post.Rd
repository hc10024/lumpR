% Generated by roxygen2 (4.1.1): do not edit by hand
% Please edit documentation in R/lump_grass_post.R
\name{lump_grass_post}
\alias{lump_grass_post}
\title{Post-processing of Landscape Unit deviation using GRASS GIS}
\usage{
lump_grass_post(dem, recl_lu = NULL, eha, fill_holes, subbasin, mask, flowacc,
  flowdir, stream_horton, soil_depth, sdr, lu, dir_out = "./",
  sub_ofile = "", lu_ofile = "", lupar_ofile = "")
}
\arguments{
\item{dem}{DEM raster map in GRASS location as used in \code{\link[LUMP]{lump_grass_prep}}.}

\item{recl_lu}{Name of GRASS reclassification file: EHA -> LU. Output of
\code{\link[LUMP]{prof_class}}. If omitted, the existing raster layer \code{eha} is used.}

\item{eha}{Name of Elementary Hillslope Areas (EHA) raster map in GRASS
location. Output of \code{\link[LUMP]{lump_grass_prep}}.}

\item{fill_holes}{TRUE: fill any holes in map \code{eha} (e.g. as result of skipped/non-classified EHAs) by growing}

\item{subbasin}{Subbasin raster map in GRASS location as used in \code{\link[LUMP]{lump_grass_prep}}
and/or created by \code{\link[LUMP]{calc_subbas}}.}

\item{mask}{Name of mask raster map masking the study area. Use output \code{mask_corr}
of \code{\link[LUMP]{lump_grass_prep}}.}

\item{flowacc}{Name of flow accumulation raster map in GRASS location. Can
be created with \code{\link[LUMP]{lump_grass_prep}}.}

\item{flowdir}{Name of flow direction raster map in GRASS location. Can
be created with \code{\link[LUMP]{lump_grass_prep}}.}

\item{stream_horton}{Name of Horton stream order raster map in GRASS location. Can
be created with \code{\link[LUMP]{lump_grass_prep}}. If left empty, the channel length, slope and retention times are set to NA.}

\item{soil_depth}{Name of soil depth [cm] raster map in GRASS location. If empty, NA is used.}

\item{sdr}{Name of sediment delivery ratio [-] raster map in GRASS location. If empty, this optional column is omitted.}

\item{lu}{Output: Name of Landscape Units (LU) raster map exported into
GRASS location.}

\item{dir_out}{Character string specifying output directory (will be created;
any overwriting will be prompted).}

\item{sub_ofile}{Output: Name of subbasin statistics file containing subbasin
parameters. See \code{Details} below.}

\item{lu_ofile}{Output: Name of file containing subbasins and the corresponding
LUs with their fraction of area in the subbasin.}

\item{lupar_ofile}{Output: Name of file containing LUs and related parameters.
     See \code{Details} below.}
}
\value{
Function returns nothing. Output files (\code{sub_ofile, lupar_ofile}) are written into output directory
     and raster maps (\code{lu}, temporary rasters stream_main_t, cell_len_t, flowacc_minmax_t, MASK_t) exported into GRASS location as specified in arguments.
}
\description{
Creates raster map of Landscape Units and files containing information of
and parameter estimation for Subbasins and Landscape Units in the catchment
using outputs of \code{\link[LUMP]{lump_grass_prep}} and \code{\link[LUMP]{prof_class}}.
}
\details{
\bold{Subbasin parameters}\cr
     Subbasin parameter estimation given in \code{sub_ofile} contains:

     \emph{pid}\cr
     Subbasin identifier.

     \emph{area}\cr
     Subbasin area in \emph{km^2}.

     \emph{drains_to}\cr
     Pid of subbasin the current subbasin drains to. It is determined by identifying
     the cell with the highest flow accumulation value (= subbasin outlet). By
     deriving the drainage direction value of that raster cell the next downstream
     cell is identified along with corresponding subbasin number.

     \emph{lag_time}\cr
     Time in \emph{days} a runoff signal in the current subbasin needs to be directed
     from the subbasin input to the outlet. Estimated from channel geometry (see below).

     \emph{retention}\cr
     Maximum time period in \emph{days} over which a runoff signal is distributed by
     the routing process. Estimated from channel geometry (see below).

     \emph{channel geometry}\cr
     Main channel length: For each subbasin the main channel is determined from Horton
     stream raster map. Its length is then calculated depending on raster resolution
     and flow direction.\cr
     Channel slope: Minimum (= inflow) and maximum (= outflow) flow accumulation and
     elevation of the corresponding raster cells are determined. The difference in
     elevation is divided by main channel length.\cr
     Channel width: Maximum flow accumulation is determined and the corresponding
     drainage area calculated by resolution of raster cells. Channel width is then
     calculated from the empirical formula: width[m] = 1.29 * darea[km2] ^ 0.6.\cr
     Channel depth: Empirical formula based on drainage area: depth[m] = 0.13 * darea[km2] ^ 0.4.\cr
     Flow velocity: Is calculated using Mannings equation with an n-value of 0.075.
     Flow velocities are calculated to derive flow travel times (velocity / channel
     length) for bankfull (= high flow condition), 2/3 (= average conditions) and
     1/10 (= low flow conditions) water levels to derive lag time (travel time for
     average conditions) and retention time (max - min travel time).

     \bold{Landscape Unit parameters}\cr
     Landscape Unit parameter estimation given in \code{lupar_ofile} contains:

     \emph{pid}\cr
     Landscape Unit identifier.

     \emph{soil_depth}\cr
     Soil depth in \emph{mm} averaged over respective landscape unit.

     \emph{gw_flag}\cr
     Groundwater flag: 0: no groundwater in this LU. 1: LU contains groundwater.
     At the moment set to 1 by default for every LU.

     \emph{gw_dist}\cr
     Initial depth of groundwater below surface in \emph{mm}. At the moment set to
     1000 by default for every LU.

     \emph{frgw_delay}\cr
     Storage coefficient for groundwater outflow in \emph{days}. At the moment set to
     200 by default for every LU.

     \emph{sdr_lu} (optional)\cr
     sediment delivery ratio from raster map \code{sdr}, if specified
}
\note{
Prepare GRASS location and necessary raster files in advance (e.g. using
     \code{\link[LUMP]{lump_grass_prep}}) and start GRASS session in R using
     \code{\link[spgrass6]{initGRASS}}.

     TODO:\cr
       - check arguments\cr
       - check empirical formulas for channel width and channel depth\cr
       - LU parameter estimation\cr
       - include options to add parameters manually in case data are available
}
\author{
Tobias Pilz \email{tpilz@uni-potsdam.de}
}
\references{
Source code based on \code{SHELL} and \code{MATLAB} scripts of Till Francke.

     Theory of LUMP:\cr
     Francke, T.; Guentner, A.; Mamede, G.; Mueller, E. N. and Bronstert, A (2008):
     Automated catena-based discretization of landscapes for the derivation of
     hydrological modelling units. \emph{International Journal of Geographical
     Information Science, Informa UK Limited}, 22(2), 111-132, DOI: 10.1080/13658810701300873

     Subbasin Parameters:\cr
     Bronstert, A., Guentner, A., Jaeger, A., Krol, M. & Krywkow, J. (1999): Grossraeumige
     hydrologische Parametrisierung und Modellierung als Teil der integrierten
     Modellierung. In: Fohrer, N. & Doell, P. (Eds.): Modellierung des Wasser- und
     Stofftransports in grossen Einzugsgebieten. \emph{Kassel University Press}, Kassel,
     Germany, 31-40.

     Guentner, A. (2002): Large-scale hydrological modelling in the semi-arid
     North-East of Brazil. \emph{PIK Report 77}, Potsdam Institute for Climate
     Impact Research, Potsdam, Germany.
}

